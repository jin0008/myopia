import{r as i,U as S,j as e,d as g,u as D,a as $}from"./index-Ci6lT7C_.js";import{P as j,a as w}from"./button-DpILQc1R.js";import{C as H,T as z}from"./div-Coub_ivx.js";import{T as c,S as G}from"./input-dlL0Jff_.js";import{d as I}from"./styled-components.browser.esm-Db0Q2RpU.js";import{u as _}from"./useMutation-D6MJQ69v.js";import{g as W,a as F,b as Z}from"./static-CztqeYEq.js";import{g as J}from"./hospital-DZ8E4L1t.js";import{r as V}from"./healthcare_professional-DU4E_weG.js";import{d as X,r as ee,g as te}from"./patient-BgngrXPo.js";import{P as ie,C as se}from"./patient_card-NkrMbLat.js";import{N as ne}from"./not_logged_in-Cu4pqUFC.js";import{p as T,H as ae}from"./hospital_selector-C8USb_JK.js";import{D as E,a as M,b as N,c as Q}from"./DialogTitle-C7sNHUiA.js";import"./theme-Dljabw6R.js";import"./delete-CVpkQKAj.js";import"./DefaultPropsProvider-BgWlOGG4.js";const re=I(H)`
  gap: 32px;
`,le=I.div`
  width: 100%;
  margin-top: 64px;
  display: flex;
  justify-content: space-between;
  align-items: center;
`;function Te(){const{user:n}=i.useContext(S),[r,a]=i.useState(!1);return n==null?e.jsx(ne,{}):n.healthcare_professional==null?e.jsxs(e.Fragment,{children:[e.jsxs(re,{children:["You are not registered as a healthcare professional.",e.jsx(j,{onClick:()=>a(!0),children:"Register"})]}),e.jsx(ue,{open:r,onClose:()=>a(!1)})]}):n.healthcare_professional.approved?e.jsx(ce,{}):e.jsxs(H,{children:["Your healthcare professional registration is pending. Please wait until it is approved.",e.jsx("br",{}),"Your user id is ",e.jsx("strong",{children:n.id})]})}function oe({value:n,onChange:r}){return e.jsx(G,{placeholder:"search by registration #",value:n,onChange:a=>r(a.target.value)})}function ce(){const[n,r]=i.useState(""),[a,o]=i.useState(!1),{user:x}=i.useContext(S),d=x.healthcare_professional.hospital;return e.jsxs(e.Fragment,{children:[e.jsxs(z,{style:{margin:"0 128px"},children:[e.jsxs(le,{children:[e.jsx(oe,{value:n,onChange:r}),e.jsx("h2",{children:d.name}),e.jsx("div",{}),e.jsx(j,{onClick:()=>o(!0),children:"new patient"})]}),e.jsx(pe,{search:n})]}),e.jsx(de,{open:a,setOpen:o})]})}function ue({open:n,onClose:r}){const a=g({queryKey:["country"],queryFn:W,staleTime:1/0,gcTime:1/0}),o=g({queryKey:["hospital"],queryFn:J}),x=g({queryKey:["ethnicity"],queryFn:F,staleTime:1/0,gcTime:1/0}),d=g({queryKey:["instrument"],queryFn:Z,staleTime:1/0,gcTime:1/0}),m=D(),h=_({mutationFn:V,onSuccess:()=>{m.invalidateQueries({queryKey:["currentUser"]}),r(),alert(u?`You are now admin of the hospital.
You can visit 'My profile' to approve others to join`:"Please wait for approval by hospital admin to join")},onError:()=>alert("An error occured")}),p=i.useRef(""),[l,y]=i.useState(""),[f,C]=i.useState(""),s=i.useRef(""),[K,P]=i.useState(""),R=i.useRef(""),q=i.useRef(""),[O,A]=i.useState(T[0]);i.useEffect(()=>{if(a.isSuccess){const t=a.data?.[0];y(t?.id),P(t?.id)}},[a.isSuccess]);const[u,k]=i.useState(!1),v=o.data?.find(t=>t.code===f)?.id,L=()=>{if(!p.current){alert("Missing field: name");return}if(u){if(!/^[a-zA-Z0-9]{1,10}$/.test(f)){alert("Invalid hospital code");return}if(!s.current){alert("Missing field: hospital name");return}if(v!=null){alert("Hospital code already exists");return}}if(!u&&v==null){alert("Hospital not found");return}const t=u?{name:s.current,country_id:K,code:f}:{id:o.data.find(U=>U.code===f)?.id},B={name:p.current,country_id:l,hospital:t,role:O,default_ethnicity_id:R.current||null,default_instrument_id:q.current||null};h.mutate(B)},[Y,b]=i.useState(!1);return e.jsxs(E,{open:n,onClose:r,children:[e.jsx(M,{children:"Register as healthcare professional"}),e.jsx(N,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"start"},children:[e.jsxs("label",{children:["Name:",e.jsx(c,{placeholder:"Name",onChange:t=>p.current=t.target.value})]}),e.jsxs("label",{children:["Country:",e.jsx(c,{as:"select",onChange:t=>y(t.target.value),children:a.data?.map(t=>e.jsxs("option",{value:t.id,children:[t.name,"(",t.code,")"]},t.id))})]}),e.jsxs("label",{children:["Join existing hospital",e.jsx("input",{type:"radio",checked:!u,onChange:t=>k(!t.target.checked)})]}),e.jsxs("label",{children:["Register new hospital",e.jsx("input",{type:"radio",checked:u,onChange:t=>k(t.target.checked)})]}),e.jsx("div",{style:{height:"16px"}}),u?e.jsxs("div",{children:[e.jsxs("label",{children:["Hospital name:",e.jsx(c,{placeholder:"Hospital name",onChange:t=>s.current=t.target.value})]}),e.jsxs("label",{children:["Hospital country:",e.jsx(c,{as:"select",onChange:t=>P(t.target.value),children:a.data?.map(t=>e.jsxs("option",{value:t.id,children:[t.name,"(",t.code,")"]},t.id))})]})]}):null,e.jsxs("label",{children:["Hospital code:",e.jsx(c,{value:f,onChange:t=>C(t.target.value),pattern:"^[a-zA-Z0-9]{1,10}$",style:{borderColor:u&&v!=null||!u&&v==null?"red":void 0}})]}),!u&&e.jsx(j,{onClick:()=>b(!0),children:"Select hospital"}),e.jsx(ae,{open:Y,onClose:()=>b(!1),onSelect:t=>{C(t.code),b(!1)}}),e.jsxs("label",{children:["Role:",e.jsx(c,{as:"select",onChange:t=>A(t.target.value),children:T.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("label",{children:["Default ethnicity(Optional)",e.jsxs(c,{as:"select",onChange:t=>R.current=t.target.value,children:[e.jsx("option",{value:"",children:"(None)"},""),x.data?.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("label",{children:["Default instrument(Optional)",e.jsxs(c,{as:"select",onChange:t=>q.current=t.target.value,children:[e.jsx("option",{value:"",children:"(None)"},""),d.data?.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]})}),e.jsxs(Q,{children:[e.jsx(w,{onClick:r,children:"Dismiss"}),e.jsx(j,{onClick:L,children:"Confirm"})]})]})}function de({open:n,setOpen:r}){const a=D(),o=g({queryKey:["ethnicity"],queryFn:F,staleTime:1/0,gcTime:1/0}),x=_({mutationFn:ee,onSuccess:()=>{a.invalidateQueries({queryKey:["patient"]}),alert("patient added"),r(!1)},onError:s=>{s.code===409||s.status===409?alert("Patient with this registration number already exists."):alert("An error occured")}}),d=i.useRef(""),[m,h]=i.useState(""),p=i.useRef(""),[l,y]=i.useState(!0),{user:f}=i.useContext(S);i.useEffect(()=>{if(o.isSuccess){const s=o.data?.[0];h(f?.healthcare_professional?.default_ethnicity_id??s?.id)}},[o.isSuccess]),i.useEffect(()=>{f?.healthcare_professional?.default_ethnicity_id&&h(f?.healthcare_professional?.default_ethnicity_id)},[n]);const C=()=>{if(!d.current){alert("Missing field: registraion #");return}if(!p.current){alert("Missing field: date of birth");return}const s={registration_number:d.current,ethnicity_id:m,date_of_birth:p.current,sex:l?"male":"female"};x.mutate(s)};return e.jsxs(E,{fullWidth:!0,open:n,onClose:()=>r(!1),children:[e.jsx(M,{children:"Register patient"}),e.jsx(N,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsxs("label",{children:["Registration #:",e.jsx(c,{placeholder:"Registration #",onChange:s=>d.current=s.target.value})]}),e.jsxs("label",{children:["Ethnicity:",e.jsx(c,{as:"select",value:m,onChange:s=>h(s.target.value),children:o.data?.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))})]}),e.jsxs("label",{children:["Date of birth:",e.jsx(c,{type:"date",onChange:s=>p.current=s.target.value})]}),e.jsxs("label",{children:[e.jsx("p",{children:"Sex:"}),e.jsxs("label",{children:["male",e.jsx("input",{type:"radio",checked:l,onClick:()=>y(!0)})]}),e.jsx("span",{children:" "}),e.jsxs("label",{children:["female",e.jsx("input",{type:"radio",checked:!l,onClick:()=>y(!1)})]})]})]})}),e.jsxs(Q,{children:[e.jsx(w,{onClick:()=>r(!1),children:"Dismiss"}),e.jsx(j,{onClick:C,children:"Confirm"})]})]})}const he=I.div`
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 16px;
  padding: 16px;
  width: 100%;
`;function pe({search:n}){const r=$(),a=D(),o=g({queryKey:["patient"],queryFn:te}),x=_({mutationFn:X,onSuccess:()=>{a.invalidateQueries({queryKey:["patient"]}),m(!1)},onError:()=>alert("An error occured")}),[d,m]=i.useState(!1),[h,p]=i.useState();return e.jsxs(e.Fragment,{children:[e.jsx(he,{children:o.data?.filter(l=>l.registration_number.includes(n))?.map(l=>e.jsx(ie,{registration:l.registration_number,dateOfBirth:l.date_of_birth.split("T")[0],sex:l.sex==="male"?"M":"F",onClick:()=>r(`/chart/${l.id}?edit=true`),onDelete:()=>{p(l),m(!0)}},l.id))}),h&&e.jsx(se,{title:"Confirm deletion",content:e.jsxs(e.Fragment,{children:["Are you sure you want to delete patient with registration number:",e.jsx("br",{}),h.registration_number,e.jsx("br",{}),e.jsx("br",{}),"All records associated with the patient will be gone forever!"]}),open:d,onClose:()=>m(!1),onConfirm:()=>{x.mutate(h.id)}})]})}export{Te as default};
